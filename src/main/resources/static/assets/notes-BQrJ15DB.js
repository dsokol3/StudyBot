import{a as x,p as f}from"./index-d5CyR_L5.js";import{a as C,b as D,o as z,s as I,n as T,u as _,d as F,r as v,c as A}from"./index-ChU9sctJ.js";const U=C({__name:"CardDescription",props:{class:{}},setup(e){const n=e;return(t,u)=>(z(),D("p",{class:T(_(x)("text-sm text-muted-foreground",n.class))},[I(t.$slots,"default")],2))}}),Q=C({__name:"CardHeader",props:{class:{}},setup(e){const n=e;return(t,u)=>(z(),D("div",{class:T(_(x)("flex flex-col gap-y-1.5 p-6",n.class))},[I(t.$slots,"default")],2))}}),j=C({__name:"CardTitle",props:{class:{}},setup(e){const n=e;return(t,u)=>(z(),D("h3",{class:T(_(x)("font-semibold leading-none tracking-tight",n.class))},[I(t.$slots,"default")],2))}}),p=f.create({baseURL:"/api/study",timeout:12e4,headers:{"Content-Type":"application/json"}});let E=0;const N=2e3;async function m(e){const t=Date.now()-E;return t<N&&await new Promise(u=>setTimeout(u,N-t)),E=Date.now(),e()}const g={async uploadNotes(e,n){const t=new FormData;t.append("file",e),t.append("conversationId",n||"default");const i=(await f.post("/api/documents/upload",t,{timeout:12e4,headers:{"Content-Type":"multipart/form-data"}})).data,h=e.name.split(".").pop()?.toLowerCase()||"txt";return{id:i.id,filename:i.filename||e.name,content:"",contentType:i.contentType,fileSizeBytes:i.fileSizeBytes,status:i.status,chunkCount:i.chunkCount,errorMessage:i.errorMessage,createdAt:i.createdAt,processedAt:i.processedAt,uploadedAt:i.createdAt||new Date().toISOString(),size:i.fileSizeBytes||e.size,type:h}},async getDocumentStatus(e){return(await f.get(`/api/documents/${e}/status`)).data},async getDocumentContent(e){return(await f.get(`/api/documents/${e}/content`)).data.content||""},async getAllDocumentContents(e="default"){return(await f.get(`/api/documents/conversation/${e}/content`)).data.content||""},async getAllDocuments(e="default"){try{return(await f.get(`/api/documents/conversation/${e}`)).data.map(t=>({id:t.id,filename:t.filename,content:"",contentType:t.contentType,fileSizeBytes:t.fileSizeBytes,status:t.status,chunkCount:t.chunkCount,errorMessage:t.errorMessage,createdAt:t.createdAt,processedAt:t.processedAt,uploadedAt:t.createdAt||new Date().toISOString(),size:t.fileSizeBytes,type:t.contentType?.includes("pdf")?"pdf":t.contentType?.includes("word")?"docx":t.contentType?.includes("markdown")?"md":"txt"}))}catch(n){return console.error("Failed to fetch documents:",n),[]}},async generateSummary(e){return m(async()=>({...(await p.post("/generate/summary",{content:e})).data,type:"summary"}))},async generateFlashcards(e,n,t){return m(async()=>{const u={content:e};return t?.easyCount!==void 0||t?.mediumCount!==void 0||t?.hardCount!==void 0?(u.easyCount=t.easyCount||0,u.mediumCount=t.mediumCount||0,u.hardCount=t.hardCount||0):u.count=n||10,{...(await p.post("/generate/flashcards",u)).data,type:"flashcards"}})},async generateQuestions(e,n){return m(async()=>({...(await p.post("/generate/questions",{content:e,count:n||5})).data,type:"questions"}))},async generateEssayPrompts(e,n){return m(async()=>({...(await p.post("/generate/essay-prompts",{content:e,count:n||3})).data,type:"essay-prompts"}))},async explainText(e){return m(async()=>({...(await p.post("/generate/explain",{content:e})).data,type:"explanations"}))},async generateDiagram(e,n="concept-map"){return m(async()=>({...(await p.post("/generate/diagram",{content:e,diagramType:n})).data,type:"diagrams",diagramType:n}))},async generateStudyPlan(e,n,t){return m(async()=>({...(await p.post("/generate/study-plan",{content:n,examDate:e,hoursPerDay:t||2})).data,type:"study-plan"}))},async exportResult(e,n,t){return(await p.post("/export",{resultType:e,result:n,format:t},{responseType:"blob"})).data}};p.interceptors.response.use(e=>(console.log("API Response:",e.config.url,e.data),e),e=>(console.error("API Error:",e.response?.status,e.response?.data,e.message),e.response?.status===429&&console.warn("Rate limited. Please wait before making another request."),Promise.reject(e)));function w(e){switch(e.split(".").pop()?.toLowerCase()){case"pdf":return"pdf";case"docx":case"doc":return"docx";case"md":case"markdown":return"md";default:return"txt"}}const H=F("notes",()=>{const e=v([]),n=v(new Map),t=v(!1),u=A(()=>e.value.length>0),i=A(()=>e.value.length),h=A(()=>e.value.map(r=>r.content||"").join(`

---

`));async function P(r,a=30){for(let o=0;o<a;o++)try{const s=await g.getDocumentStatus(r);if(s.status==="COMPLETED"){const c=await g.getDocumentContent(r),l=e.value.findIndex(S=>S.id===r),d=e.value[l];return l!==-1&&d&&(d.content=c,d.status="COMPLETED",y()),!0}else if(s.status==="FAILED")return!1;await new Promise(c=>setTimeout(c,1e3))}catch{await new Promise(s=>setTimeout(s,1e3))}return!1}async function k(r="default"){try{const a=await g.getAllDocuments(r);if(!a||a.length===0)return!0;const o=new Set(a.map(s=>s.id));e.value=e.value.filter(s=>o.has(s.id));for(const s of a){const c=e.value.findIndex(l=>l.id===s.id);if(c>=0?e.value[c]={...e.value[c],...s,type:s.type||w(s.filename)||"txt",size:s.size||s.fileSizeBytes||0,uploadedAt:s.uploadedAt||s.createdAt||new Date().toISOString()}:e.value.push({...s,type:s.type||w(s.filename)||"txt",size:s.size||s.fileSizeBytes||0,uploadedAt:s.uploadedAt||s.createdAt||new Date().toISOString()}),s.status==="COMPLETED"&&!s.content)try{const l=await g.getDocumentContent(s.id),d=e.value.find(S=>S.id===s.id);d&&(d.content=l)}catch(l){console.warn(`Could not fetch content for ${s.id}:`,l)}}return y(),!0}catch(a){return console.warn("Could not sync documents from backend:",a),!1}}async function b(r){const a=[];for(const o of r){const s=crypto.randomUUID();n.value.set(s,{id:s,filename:o.name,progress:0,status:"uploading"});try{const c=await g.uploadNotes(o),l={...c,type:c.type||w(c.filename)||"txt",size:c.size||c.fileSizeBytes||o.size,uploadedAt:c.uploadedAt||new Date().toISOString()};e.value.push(l),n.value.set(s,{id:s,filename:o.name,progress:50,status:"processing"}),await P(c.id)?(n.value.set(s,{id:s,filename:o.name,progress:100,status:"complete"}),a.push({success:!0,note:c})):(n.value.set(s,{id:s,filename:o.name,progress:0,status:"error",error:"Processing failed"}),a.push({success:!1,error:"Processing failed"})),y(),setTimeout(()=>{n.value.delete(s)},2e3)}catch(c){const l=c instanceof Error?c.message:"Upload failed";n.value.set(s,{id:s,filename:o.name,progress:0,status:"error",error:l}),a.push({success:!1,error:l})}}return a}function O(r){const a={...r,type:r.type||w(r.filename)||"txt",size:r.size||r.fileSizeBytes||0,uploadedAt:r.uploadedAt||new Date().toISOString()};e.value.push(a),y()}function L(r){const a=e.value.findIndex(o=>o.id===r);a!==-1&&(e.value.splice(a,1),y())}function M(){n.value.clear()}function $(){e.value=[],n.value.clear(),localStorage.removeItem("study-notes")}function y(){localStorage.setItem("study-notes",JSON.stringify(e.value))}function B(){if(t.value)return;const r=localStorage.getItem("study-notes");if(r)try{const a=JSON.parse(r);e.value=a.map(o=>({...o,type:o.type||w(o.filename)||"txt",size:o.size||o.fileSizeBytes||0,uploadedAt:o.uploadedAt||o.createdAt||new Date().toISOString()}))}catch{localStorage.removeItem("study-notes")}t.value=!0,setTimeout(()=>{k().catch(a=>{console.warn("Background document sync skipped:",a)})},1e3)}return B(),{notes:e,uploadQueue:n,hasNotes:u,totalNotes:i,combinedContent:h,uploadFiles:b,addLocalNote:O,removeNote:L,clearUploadQueue:M,clearAll:$,hydrate:B,syncFromBackend:k}});export{Q as _,j as a,U as b,g as s,H as u};
