import{a as S,p as f}from"./index-C4Lle3dT.js";import{a as D,b as x,o as T,s as A,n as _,u as k,d as R,r as v,c as C}from"./index-BpwbO6jE.js";const F=D({__name:"CardDescription",props:{class:{}},setup(e){const s=e;return(t,r)=>(T(),x("p",{class:_(k(S)("text-sm text-muted-foreground",s.class))},[A(t.$slots,"default")],2))}}),U=D({__name:"CardHeader",props:{class:{}},setup(e){const s=e;return(t,r)=>(T(),x("div",{class:_(k(S)("flex flex-col gap-y-1.5 p-6",s.class))},[A(t.$slots,"default")],2))}}),Q=D({__name:"CardTitle",props:{class:{}},setup(e){const s=e;return(t,r)=>(T(),x("h3",{class:_(k(S)("font-semibold leading-none tracking-tight",s.class))},[A(t.$slots,"default")],2))}}),p=f.create({baseURL:"/api/study",timeout:12e4,headers:{"Content-Type":"application/json"}});let P=0;const b=1e3;async function d(e){const t=Date.now()-P;return t<b&&await new Promise(r=>setTimeout(r,b-t)),P=Date.now(),e()}const g={async uploadNotes(e,s){const t=new FormData;t.append("file",e),t.append("conversationId",s||"default");const c=(await f.post("/api/documents/upload",t,{timeout:12e4,headers:{"Content-Type":"multipart/form-data"}})).data,w=e.name.split(".").pop()?.toLowerCase()||"txt";return{id:c.id,filename:c.filename||e.name,content:"",contentType:c.contentType,fileSizeBytes:c.fileSizeBytes,status:c.status,chunkCount:c.chunkCount,errorMessage:c.errorMessage,createdAt:c.createdAt,processedAt:c.processedAt,uploadedAt:c.createdAt||new Date().toISOString(),size:c.fileSizeBytes||e.size,type:w}},async getDocumentStatus(e){return(await f.get(`/api/documents/${e}/status`)).data},async getDocumentContent(e){return(await f.get(`/api/documents/${e}/content`)).data.content||""},async getAllDocumentContents(e="default"){return(await f.get(`/api/documents/conversation/${e}/content`)).data.content||""},async getAllDocuments(e="default"){try{return(await f.get(`/api/documents/conversation/${e}`)).data.map(t=>({id:t.id,filename:t.filename,content:"",contentType:t.contentType,fileSizeBytes:t.fileSizeBytes,status:t.status,chunkCount:t.chunkCount,errorMessage:t.errorMessage,createdAt:t.createdAt,processedAt:t.processedAt,uploadedAt:t.createdAt||new Date().toISOString(),size:t.fileSizeBytes,type:t.contentType?.includes("pdf")?"pdf":t.contentType?.includes("word")?"docx":t.contentType?.includes("markdown")?"md":"txt"}))}catch(s){return console.error("Failed to fetch documents:",s),[]}},async generateSummary(e){return d(async()=>({...(await p.post("/generate/summary",{content:e})).data,type:"summary"}))},async generateFlashcards(e,s,t){return d(async()=>{const r={content:e};return t?.easyCount!==void 0||t?.mediumCount!==void 0||t?.hardCount!==void 0?(r.easyCount=t.easyCount||0,r.mediumCount=t.mediumCount||0,r.hardCount=t.hardCount||0):r.count=s||10,{...(await p.post("/generate/flashcards",r)).data,type:"flashcards"}})},async generateQuestions(e,s){return d(async()=>({...(await p.post("/generate/questions",{content:e,count:s||5})).data,type:"questions"}))},async generateEssayPrompts(e,s){return d(async()=>({...(await p.post("/generate/essay-prompts",{content:e,count:s||3})).data,type:"essay-prompts"}))},async explainText(e){return d(async()=>({...(await p.post("/generate/explain",{content:e})).data,type:"explanations"}))},async generateDiagram(e,s="concept-map"){return d(async()=>({...(await p.post("/generate/diagram",{content:e,diagramType:s})).data,type:"diagrams",diagramType:s}))},async generateStudyPlan(e,s,t){return d(async()=>({...(await p.post("/generate/study-plan",{content:s,examDate:e,hoursPerDay:t||2})).data,type:"study-plan"}))},async exportResult(e,s,t){return(await p.post("/export",{resultType:e,result:s,format:t},{responseType:"blob"})).data}};p.interceptors.response.use(e=>e,e=>(e.response?.status===429&&console.warn("Rate limited. Please wait before making another request."),Promise.reject(e)));const j=R("notes",()=>{const e=v([]),s=v(new Map),t=v(!1),r=C(()=>e.value.length>0),c=C(()=>e.value.length),w=C(()=>e.value.map(o=>o.content||"").join(`

---

`));async function N(o,a=30){for(let i=0;i<a;i++)try{const n=await g.getDocumentStatus(o);if(n.status==="COMPLETED"){const u=await g.getDocumentContent(o),l=e.value.findIndex(h=>h.id===o),m=e.value[l];return l!==-1&&m&&(m.content=u,m.status="COMPLETED",y()),!0}else if(n.status==="FAILED")return!1;await new Promise(u=>setTimeout(u,1e3))}catch{await new Promise(n=>setTimeout(n,1e3))}return!1}async function I(o="default"){try{const a=await g.getAllDocuments(o);if(!a||a.length===0)return!0;const i=new Set(a.map(n=>n.id));e.value=e.value.filter(n=>i.has(n.id));for(const n of a){const u=e.value.findIndex(l=>l.id===n.id);if(u>=0?e.value[u]={...e.value[u],...n}:e.value.push(n),n.status==="COMPLETED"&&!n.content)try{const l=await g.getDocumentContent(n.id),m=e.value.find(h=>h.id===n.id);m&&(m.content=l)}catch(l){console.warn(`Could not fetch content for ${n.id}:`,l)}}return y(),!0}catch(a){return console.warn("Could not sync documents from backend:",a),!1}}async function z(o){const a=[];for(const i of o){const n=crypto.randomUUID();s.value.set(n,{id:n,filename:i.name,progress:0,status:"uploading"});try{const u=await g.uploadNotes(i);e.value.push(u),s.value.set(n,{id:n,filename:i.name,progress:50,status:"processing"}),await N(u.id)?(s.value.set(n,{id:n,filename:i.name,progress:100,status:"complete"}),a.push({success:!0,note:u})):(s.value.set(n,{id:n,filename:i.name,progress:0,status:"error",error:"Processing failed"}),a.push({success:!1,error:"Processing failed"})),y(),setTimeout(()=>{s.value.delete(n)},2e3)}catch(u){const l=u instanceof Error?u.message:"Upload failed";s.value.set(n,{id:n,filename:i.name,progress:0,status:"error",error:l}),a.push({success:!1,error:l})}}return a}function B(o){e.value.push(o),y()}function M(o){const a=e.value.findIndex(i=>i.id===o);a!==-1&&(e.value.splice(a,1),y())}function $(){s.value.clear()}function L(){e.value=[],s.value.clear(),localStorage.removeItem("study-notes")}function y(){localStorage.setItem("study-notes",JSON.stringify(e.value))}function E(){if(t.value)return;const o=localStorage.getItem("study-notes");if(o)try{e.value=JSON.parse(o)}catch{localStorage.removeItem("study-notes")}t.value=!0,setTimeout(()=>{I().catch(a=>{console.warn("Background document sync skipped:",a)})},1e3)}return E(),{notes:e,uploadQueue:s,hasNotes:r,totalNotes:c,combinedContent:w,uploadFiles:z,addLocalNote:B,removeNote:M,clearUploadQueue:$,clearAll:L,hydrate:E,syncFromBackend:I}});export{U as _,Q as a,F as b,g as s,j as u};
